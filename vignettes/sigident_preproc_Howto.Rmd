---
title: "sigident.preproc - Preprocessing GEO datasets"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{sigident_preproc_Howto}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

In order to use the R package `sigident` and its functions with GEO datasets, these datasets have first to be downloaded and preprocessed. The preprocessing includes the creation of a merged gene expression data set, extraction of sample metadata and batch correction. 
The R package `sigident` can be found [here](https://gitlab.miracum.org/clearly/sigident).

# Setup

Initially, the R package needs to be loaded and the variable `datadir` and `plotdir` need to be defined. `datadir` points to the folder, where the GEO datasets are downloaded and stored. `plotdir` points to the folder, where resulting plots are stored.

```{r setup}
library(sigident.preproc)

# initialize filePath:
filePath <- tempdir()

# define datadir
maindir <- "./geodata/"
datadir <- paste0(maindir, "data/")
dir.create(maindir)
dir.create(datadir)

# define plotdir
plotdir <- "./plots/"
dir.create(plotdir)

# define idtype
idtype = "affy"
```

# Define list that contains a representation of the studies metadata

Definition of a list that contains a representation of the studie's / studies' metadata

This example uses the GEO lung cancer studies "GSE18842", "GSE19804" and "GSE19188", which contain in total 367 samples (197 tumor; 170 non-tumor) and 54,675 transcripts obtained by using Affymetrix GeneChip Human Genome U133 Plus 2.0 Array (platform GPL570).  

The mapping information include the `setid` (which GEO set should be used, normally '1'), the `targetcolname` (the name of the column holding the variable of interest), the `targetlevelname` (the value of the positive outcomes in `targetcolname`) and the `controllevelname`  (the value of the negative outcomes in `targetcolname`) need to be represented in the `studiesinfo` list object. If specifying `'use_rawdata' = TRUE`, raw the data is downloaded in CEL file format, uncompressed and subsequently normalized with a GCRMA normalization. The directory specified in `datadir` will be used for storing downloaded files. 

```{r}
studiesinfo <- list(
  "GSE18842" = list(
    setid = 1,
    targetcolname = "source_name_ch1",
    targetlevelname = "Human Lung Tumor",
    controllevelname = "Human Lung Control"
    ),
  
  "GSE19804" = list(
    setid = 1,
    targetcolname = "source_name_ch1",
    targetlevelname = "frozen tissue of primary tumor",
    controllevelname = "frozen tissue of adjacent normal"
  ),
  
  "GSE19188" = list(
    setid = 1,
    targetcolname = "characteristics_ch1",
    controllevelname = "tissue type: healthy",
    targetlevelname = "tissue type: tumor",
    use_rawdata = TRUE
  )
)
```

# Load GEO datasets

All downloaded datasets will be assigned to the global environment. 

```{r results='hide', message=FALSE, warning=FALSE, error=FALSE}
load_geo_data(studiesinfo = studiesinfo,
              datadir = datadir,
              plotdir = plotdir,
              idtype = idtype) 
```

# List files in .Globalenv

```{r}
ls()
```

